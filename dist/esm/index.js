import{jsxs as e,jsx as t}from"react/jsx-runtime";import{useRef as n,useState as a,useEffect as o,useCallback as r}from"react";const i=(e,t)=>{const i=n([]),[l,d]=a(!0),[c,s]=a({width:t.width||800,height:t.height||300,penColor:t.penColor||"#000000",penWidth:t.penWidth||2,backgroundColor:t.backgroundColor||"#ffffff",drawingMode:t.drawingMode||"pen",minWidth:t.minWidth||.5,maxWidth:t.maxWidth||2.5,velocityFilterWeight:t.velocityFilterWeight||.7});o(()=>{s(e=>({...e,...t,width:t.width||e.width,height:t.height||e.height}))},[t]),o(()=>{const t=e.current;if(!t)return;const n=t.getContext("2d");n&&(n.lineCap="round",n.lineJoin="round",n.fillStyle=c.backgroundColor,n.fillRect(0,0,t.width,t.height),d(!0))},[e,c.backgroundColor]);const h={start:r(t=>{const n=e.current;if(!n)return;const a=n.getContext("2d");if(!a)return;const o=n.getBoundingClientRect(),r="touches"in t?t.touches[0].clientX:t.clientX,l="touches"in t?t.touches[0].clientY:t.clientY,c={x:r-o.left,y:l-o.top,time:Date.now(),pressure:"pressure"in t?t.pressure:.5};i.current=[c],d(!1),a.beginPath(),a.moveTo(c.x,c.y)},[e]),move:r(t=>{if(0===i.current.length)return;const n=e.current;if(!n)return;const a=n.getContext("2d");if(!a)return;const o=n.getBoundingClientRect(),r="touches"in t?t.touches[0].clientX:t.clientX,l="touches"in t?t.touches[0].clientY:t.clientY,d={x:r-o.left,y:l-o.top,time:Date.now(),pressure:"pressure"in t?t.pressure:.5},s=i.current;s.push(d);const h=(e=>{if(e.length<2)return 0;const t=e[e.length-1],n=e[e.length-2],a=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),o=t.time-n.time;return o>0?a/o:0})(s),g=c.penWidth;let u=g;"marker"===c.drawingMode?u=Math.max(c.minWidth,g-h*g/3):"highlighter"===c.drawingMode?(u=g+2,a.globalAlpha=.5):u=Math.max(c.minWidth,Math.min(c.maxWidth,g-h*g/5)),a.lineWidth=u,a.strokeStyle=c.penColor,((e,t)=>{if(t.length<3){const n=t[0];return e.lineTo(n.x,n.y),void e.stroke()}e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let n=1;n<t.length-2;n++){const a=(t[n].x+t[n+1].x)/2,o=(t[n].y+t[n+1].y)/2;e.quadraticCurveTo(t[n].x,t[n].y,a,o)}e.quadraticCurveTo(t[t.length-2].x,t[t.length-2].y,t[t.length-1].x,t[t.length-1].y),e.stroke()})(a,s),"highlighter"===c.drawingMode&&(a.globalAlpha=1),s.length>5&&(i.current=s.slice(-5))},[e,c]),end:r(()=>{i.current=[]},[])},g=r(()=>{const t=e.current;if(!t)return;const n=t.getContext("2d");n&&(n.clearRect(0,0,t.width,t.height),n.fillStyle=c.backgroundColor,n.fillRect(0,0,t.width,t.height),d(!0),i.current=[])},[e,c.backgroundColor]),u=r((t,n)=>{const a=e.current;return!a||l?"":a.toDataURL(t,n)},[e,l]),p=r((e="signature")=>{const t=u("image/png");if(!t)return;const n=document.createElement("a");n.download=`${e}.png`,n.href=t,n.click()},[u]),m=r(()=>"",[]),v=r(e=>{s(t=>({...t,drawingMode:e}))},[]),C=r(e=>{s(t=>({...t,penColor:e}))},[]),w=r(e=>{s(t=>({...t,penWidth:e}))},[]),x=r(t=>{s(e=>({...e,backgroundColor:t}));const n=e.current;if(n){const e=n.getContext("2d");if(e&&(e.fillStyle=t,e.fillRect(0,0,n.width,n.height),!l)){const t=u("image/png");if(t){const n=new Image;n.onload=()=>{e.drawImage(n,0,0)},n.src=t}}}},[e,l,u]),b=r(e=>{s(t=>({...t,minWidth:e}))},[]),f=r(e=>{s(t=>({...t,maxWidth:e}))},[]),y=r(e=>{s(t=>({...t,velocityFilterWeight:e}))},[]);return{isEmpty:l,draw:h,clear:g,undo:()=>{},redo:()=>{},canUndo:!1,canRedo:!1,exportAsImage:p,exportAsSVG:m,toDataURL:u,setDrawingMode:v,setPenColor:C,setPenWidth:w,setBackgroundColor:x,setMinWidth:b,setMaxWidth:f,setVelocityFilterWeight:y,currentOptions:c}},l=e=>{const[t,n]=a([]),[o,i]=a([]),[l]=a(50),d=r(e=>{n(t=>[...t,e].slice(-l)),i([])},[l]),c=r(()=>{if(0===t.length)return;const a=t[t.length-1],o=e();return n(e=>e.slice(0,-1)),i(e=>[o,...e]),a},[t,e]),s=r(()=>{if(0===o.length)return;const t=o[0];return n(t=>[...t,e()]),i(e=>e.slice(1)),t},[o,e]),h=r(()=>{n([]),i([])},[]);return{addState:d,undo:c,redo:s,canUndo:t.length>0,canRedo:o.length>0,clearHistory:h}},d=({onUndo:n,onRedo:a,onClear:o,onSave:r,onUpload:i,onDrawingModeChange:l,onPenColorChange:d,onPenWidthChange:c,canUndo:s,canRedo:h,isEmpty:g,currentOptions:u,saveText:p="Save",uploadText:m="Upload",clearText:v="Clear",onDownload:C,onResetPen:w,showGrid:x=!1,onToggleGrid:b,showEraser:f=!1,onEraserMode:y,theme:W="default"})=>{const M="tailwind"===W?"sig-pad-toolbar-btn":"control-button";return e("div",{className:"tailwind"===W?"signature-controls flex flex-wrap gap-2 mb-2":"signature-controls",role:"toolbar","aria-label":"Signature controls",children:[e("div",{className:"controls-left flex items-center gap-2 flex-wrap",children:[t("button",{onClick:n,disabled:!s,className:M,title:"Undo","aria-label":"Undo",children:"↶"}),t("button",{onClick:a,disabled:!h,className:M,title:"Redo","aria-label":"Redo",children:"↷"}),e("select",{value:u.drawingMode,onChange:e=>l(e.target.value),className:"tailwind"===W?"control-select h-8 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm px-2":"control-select","aria-label":"Drawing mode",children:[t("option",{value:"pen",children:"Pen"}),t("option",{value:"marker",children:"Marker"}),t("option",{value:"highlighter",children:"Highlighter"}),f&&t("option",{value:"eraser",children:"Eraser"})]}),t("input",{type:"color",value:u.penColor,onChange:e=>d(e.target.value),className:"tailwind"===W?"control-color h-8 w-10 border border-gray-300 dark:border-gray-600 rounded-md overflow-hidden":"control-color",title:"Pen Color","aria-label":"Pen color"}),t("input",{type:"range",min:"1",max:"10",value:u.penWidth,onChange:e=>c(parseInt(e.target.value)),className:"tailwind"===W?"control-slider cursor-pointer accent-brand-600":"control-slider",title:"Pen Width","aria-label":"Pen width"}),e("span",{className:"pen-width-label","aria-label":"Pen width value",children:[u.penWidth,"px"]}),w&&t("button",{onClick:w,className:M,title:"Reset Pen Settings","aria-label":"Reset pen settings",children:"Reset"}),f&&y&&t("button",{onClick:y,className:M,title:"Eraser Mode","aria-label":"Eraser mode",children:"Eraser"}),b&&t("button",{onClick:b,className:M,title:x?"Hide Grid":"Show Grid","aria-label":x?"Hide grid":"Show grid",children:x?"Hide Grid":"Show Grid"})]}),e("div",{className:"controls-right flex items-center gap-2 flex-wrap",children:[t("button",{onClick:o,className:`${M} clear-button`,title:v,"aria-label":"Clear signature",children:v}),r&&t("button",{onClick:r,disabled:g,className:`${M} save-button`,title:p,"aria-label":"Save signature",children:p}),i&&t("button",{onClick:i,disabled:g,className:`${M} upload-button`,title:m,"aria-label":"Upload signature",children:m}),C&&t("button",{onClick:C,disabled:g,className:M,title:"Download signature","aria-label":"Download signature",children:"Download"})]})]})},c=({options:n,onOptionsChange:a,onClose:o})=>{const r=(e,t)=>{a({[e]:t})};return e("div",{className:"signature-customization-panel",children:[e("div",{className:"panel-header",children:[t("h3",{children:"Customize Signature"}),t("button",{onClick:o,className:"close-button",children:"×"})]}),e("div",{className:"panel-content",children:[e("div",{className:"option-group",children:[t("label",{children:"Pen Color"}),t("input",{type:"color",value:n.penColor||"#000000",onChange:e=>r("penColor",e.target.value)})]}),e("div",{className:"option-group",children:[t("label",{children:"Pen Width"}),t("input",{type:"range",min:"1",max:"10",value:n.penWidth||2,onChange:e=>r("penWidth",parseInt(e.target.value))}),e("span",{children:[n.penWidth||2,"px"]})]}),e("div",{className:"option-group",children:[t("label",{children:"Background Color"}),t("input",{type:"color",value:n.backgroundColor||"#ffffff",onChange:e=>r("backgroundColor",e.target.value)})]}),e("div",{className:"option-group",children:[t("label",{children:"Drawing Mode"}),e("select",{value:n.drawingMode||"pen",onChange:e=>r("drawingMode",e.target.value),children:[t("option",{value:"pen",children:"Pen"}),t("option",{value:"marker",children:"Marker"}),t("option",{value:"highlighter",children:"Highlighter"})]})]}),e("div",{className:"option-group",children:[t("label",{children:"Min Width"}),t("input",{type:"range",min:"0.5",max:"5",step:"0.5",value:n.minWidth||.5,onChange:e=>r("minWidth",parseFloat(e.target.value))}),e("span",{children:[n.minWidth||.5,"px"]})]}),e("div",{className:"option-group",children:[t("label",{children:"Max Width"}),t("input",{type:"range",min:"1",max:"10",step:"0.5",value:n.maxWidth||2.5,onChange:e=>r("maxWidth",parseFloat(e.target.value))}),e("span",{children:[n.maxWidth||2.5,"px"]})]}),e("div",{className:"option-group",children:[t("label",{children:"Velocity Sensitivity"}),t("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:n.velocityFilterWeight||.7,onChange:e=>r("velocityFilterWeight",parseFloat(e.target.value))}),t("span",{children:n.velocityFilterWeight||.7})]})]})]})},s=({onSave:s,onUpload:h,onClear:g,onChange:u,options:p={},className:m="",showControls:v=!0,showCustomization:C=!0,uploadButton:w=!1,uploadText:x="Upload Signature",saveButton:b=!0,saveText:f="Save Signature",clearButton:y=!0,clearText:W="Clear",maxWidth:M=800,maxHeight:k=300,theme:N="default",showDarkModeToggle:S=!1})=>{const R=n(null),E=n(null),[P,T]=a(!1),[D,U]=a(!1),[z,F]=a(p),{isEmpty:A,draw:B,clear:H,undo:X,redo:Y,canUndo:I,canRedo:G,exportAsImage:O,exportAsSVG:L,toDataURL:V,setDrawingMode:$,setPenColor:q,setPenWidth:j,setBackgroundColor:J,setMinWidth:K,setMaxWidth:Q,setVelocityFilterWeight:Z,currentOptions:_}=i(R,z),{addState:ee,undo:te,redo:ne,canUndo:ae,canRedo:oe}=l(()=>V("image/png")),re=r(()=>{te()},[te]),ie=r(()=>{ne()},[ne]);o(()=>{P||A||ee(V("image/png"))},[P,A,ee]),o(()=>{null==u||u(A)},[A,u]);const le=r(()=>{const e=V("image/png");null==s||s(e)},[V,s]),de=r(()=>{const e=V("image/png");if(h)h(e);else{const t=document.createElement("a");t.download="signature.png",t.href=e,t.click()}},[V,h]),ce=r(()=>{H(),null==g||g(),ee(V("image/png"))},[H,g,ee]),se=r(e=>{F(t=>({...t,...e})),e.penColor&&q(e.penColor),e.penWidth&&j(e.penWidth),e.backgroundColor&&J(e.backgroundColor),e.drawingMode&&$(e.drawingMode),e.minWidth&&K(e.minWidth),e.maxWidth&&Q(e.maxWidth),e.velocityFilterWeight&&Z(e.velocityFilterWeight)},[q,j,J,$,K,Q,Z]);o(()=>{const e=()=>{if(R.current&&E.current){const e=E.current.clientWidth,t=Math.min(e,M),n=k;if(R.current.width=t,R.current.height=n,A){const e=R.current.getContext("2d");e&&z.backgroundColor&&(e.fillStyle=z.backgroundColor,e.fillRect(0,0,t,n))}else{const e=V("image/png"),a=R.current.getContext("2d");if(a&&e){const o=new Image;o.onload=()=>{a.drawImage(o,0,0,t,n)},o.src=e}}}};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[A,V,M,k,z.backgroundColor]);const he=["react-signature-pad",m,"tailwind"===N?"sig-pad-container":""].filter(Boolean).join(" ");return e("div",{className:he,ref:E,style:{maxWidth:`${M}px`,maxHeight:`${k+100}px`},children:[S&&t("button",{type:"button",onClick:()=>document.documentElement.classList.toggle("dark"),className:"tailwind"===N?"sig-pad-dark-toggle":"customize-toggle","aria-label":"Toggle dark mode",children:"tailwind"===N?t("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:t("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})}):"Dark Mode"}),C&&t("button",{className:"tailwind"===N?"sig-pad-toolbar-btn mb-4":"customize-toggle",onClick:()=>U(!D),children:D?"Hide Options":"Customize"}),D&&t(c,{options:z,onOptionsChange:se,onClose:()=>U(!1)}),v&&t(d,{onUndo:re,onRedo:ie,onClear:ce,onSave:b?le:void 0,onUpload:w?de:void 0,onDrawingModeChange:$,onPenColorChange:q,onPenWidthChange:j,canUndo:ae,canRedo:oe,isEmpty:A,currentOptions:_,saveText:f,uploadText:x,clearText:W,theme:N}),e("div",{className:"signature-canvas-container "+("tailwind"===N?"sig-pad-canvas-container":""),children:[t("canvas",{ref:R,className:"signature-canvas "+("tailwind"===N?"sig-pad-canvas":""),onMouseDown:e=>{T(!0),B.start(e.nativeEvent)},onMouseMove:e=>{P&&B.move(e.nativeEvent)},onMouseUp:()=>{T(!1),B.end()},onMouseLeave:()=>{P&&(T(!1),B.end())},onTouchStart:e=>{T(!0),B.start(e.nativeEvent),e.preventDefault()},onTouchMove:e=>{P&&(B.move(e.nativeEvent),e.preventDefault())},onTouchEnd:()=>{T(!1),B.end()},onTouchCancel:()=>{T(!1),B.end()}}),A&&t("div",{className:"signature-placeholder "+("tailwind"===N?"text-gray-400 dark:text-gray-500":""),children:"Sign here"})]})]})},h=e=>{const t=e.split(";base64,"),n=t[0].split(":")[1],a=window.atob(t[1]),o=new Uint8Array(a.length);for(let e=0;e<a.length;++e)o[e]=a.charCodeAt(e);return new Blob([o],{type:n})},g=(e,t)=>{const n=document.createElement("a");n.download=t,n.href=e,n.click()},u=(e,t)=>{const n=h(e);return new File([n],t,{type:n.type})},p=async(e,t,n="signature")=>{const a=new FormData,o=u(e,"signature.png");return a.append(n,o),fetch(t,{method:"POST",body:a})},m=e=>{if(e.length<5)return!1;const t=v(e);if((t.maxX-t.minX)*(t.maxY-t.minY)<100)return!1;return!(C(e)<50)},v=e=>{if(0===e.length)return{minX:0,minY:0,maxX:0,maxY:0};let t=e[0].x,n=e[0].y,a=e[0].x,o=e[0].y;for(let r=1;r<e.length;r++)t=Math.min(t,e[r].x),n=Math.min(n,e[r].y),a=Math.max(a,e[r].x),o=Math.max(o,e[r].y);return{minX:t,minY:n,maxX:a,maxY:o}},C=e=>{let t=0;for(let n=1;n<e.length;n++)t+=Math.sqrt(Math.pow(e[n].x-e[n-1].x,2)+Math.pow(e[n].y-e[n-1].y,2));return t},w=e=>{if(!document.createElement("canvas").getContext("2d"))return!0;return(new Image).src=e,""===e||e.includes("data:image/png;base64,AAAA")};export{s as SignaturePad,C as calculateTotalDistance,h as dataURLToBlob,u as dataURLToFile,g as downloadDataURL,v as getBoundingBox,w as isSignatureEmpty,p as uploadDataURL,i as useSignature,l as useUndoRedo,m as validateSignature};
//# sourceMappingURL=index.js.map
