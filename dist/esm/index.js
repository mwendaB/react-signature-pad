import{jsxs as e,jsx as t}from"react/jsx-runtime";import{useRef as n,useState as o,useEffect as a,useCallback as r}from"react";const i=(e,t)=>{const i=n([]),[l,c]=o(!0),[d,s]=o({width:t.width||800,height:t.height||300,penColor:t.penColor||"#000000",penWidth:t.penWidth||2,backgroundColor:t.backgroundColor||"#ffffff",drawingMode:t.drawingMode||"pen",minWidth:t.minWidth||.5,maxWidth:t.maxWidth||2.5,velocityFilterWeight:t.velocityFilterWeight||.7});a(()=>{s(e=>({...e,...t,width:t.width||e.width,height:t.height||e.height}))},[t]),a(()=>{const t=e.current;if(!t)return;const n=t.getContext("2d");n&&(n.lineCap="round",n.lineJoin="round",n.fillStyle=d.backgroundColor,n.fillRect(0,0,t.width,t.height),c(!0))},[e,d.backgroundColor]);const h={start:r(t=>{const n=e.current;if(!n)return;const o=n.getContext("2d");if(!o)return;const a=n.getBoundingClientRect(),r="touches"in t?t.touches[0].clientX:t.clientX,l="touches"in t?t.touches[0].clientY:t.clientY,d={x:r-a.left,y:l-a.top,time:Date.now(),pressure:"pressure"in t?t.pressure:.5};i.current=[d],c(!1),o.beginPath(),o.moveTo(d.x,d.y)},[e]),move:r(t=>{if(0===i.current.length)return;const n=e.current;if(!n)return;const o=n.getContext("2d");if(!o)return;const a=n.getBoundingClientRect(),r="touches"in t?t.touches[0].clientX:t.clientX,l="touches"in t?t.touches[0].clientY:t.clientY,c={x:r-a.left,y:l-a.top,time:Date.now(),pressure:"pressure"in t?t.pressure:.5},s=i.current;s.push(c);const h=(e=>{if(e.length<2)return 0;const t=e[e.length-1],n=e[e.length-2],o=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),a=t.time-n.time;return a>0?o/a:0})(s),u=d.penWidth;let g=u;"marker"===d.drawingMode?g=Math.max(d.minWidth,u-h*u/3):"highlighter"===d.drawingMode?(g=u+2,o.globalAlpha=.5):g=Math.max(d.minWidth,Math.min(d.maxWidth,u-h*u/5)),o.lineWidth=g,o.strokeStyle=d.penColor,((e,t)=>{if(t.length<3){const n=t[0];return e.lineTo(n.x,n.y),void e.stroke()}e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let n=1;n<t.length-2;n++){const o=(t[n].x+t[n+1].x)/2,a=(t[n].y+t[n+1].y)/2;e.quadraticCurveTo(t[n].x,t[n].y,o,a)}e.quadraticCurveTo(t[t.length-2].x,t[t.length-2].y,t[t.length-1].x,t[t.length-1].y),e.stroke()})(o,s),"highlighter"===d.drawingMode&&(o.globalAlpha=1),s.length>5&&(i.current=s.slice(-5))},[e,d]),end:r(()=>{i.current=[]},[])},u=r(()=>{const t=e.current;if(!t)return;const n=t.getContext("2d");n&&(n.clearRect(0,0,t.width,t.height),n.fillStyle=d.backgroundColor,n.fillRect(0,0,t.width,t.height),c(!0),i.current=[])},[e,d.backgroundColor]),g=r((t,n)=>{const o=e.current;return!o||l?"":o.toDataURL(t,n)},[e,l]),p=r((e="signature")=>{const t=g("image/png");if(!t)return;const n=document.createElement("a");n.download=`${e}.png`,n.href=t,n.click()},[g]),m=r(()=>"",[]),v=r(e=>{s(t=>({...t,drawingMode:e}))},[]),C=r(e=>{s(t=>({...t,penColor:e}))},[]),x=r(e=>{s(t=>({...t,penWidth:e}))},[]),b=r(t=>{s(e=>({...e,backgroundColor:t}));const n=e.current;if(n){const e=n.getContext("2d");if(e&&(e.fillStyle=t,e.fillRect(0,0,n.width,n.height),!l)){const t=g("image/png");if(t){const n=new Image;n.onload=()=>{e.drawImage(n,0,0)},n.src=t}}}},[e,l,g]),w=r(e=>{s(t=>({...t,minWidth:e}))},[]),f=r(e=>{s(t=>({...t,maxWidth:e}))},[]),W=r(e=>{s(t=>({...t,velocityFilterWeight:e}))},[]);return{isEmpty:l,draw:h,clear:u,undo:()=>{},redo:()=>{},canUndo:!1,canRedo:!1,exportAsImage:p,exportAsSVG:m,toDataURL:g,setDrawingMode:v,setPenColor:C,setPenWidth:x,setBackgroundColor:b,setMinWidth:w,setMaxWidth:f,setVelocityFilterWeight:W,currentOptions:d}},l=e=>{const[t,n]=o([]),[a,i]=o([]),[l]=o(50),c=r(e=>{n(t=>[...t,e].slice(-l)),i([])},[l]),d=r(()=>{if(0===t.length)return;const o=t[t.length-1],a=e();return n(e=>e.slice(0,-1)),i(e=>[a,...e]),o},[t,e]),s=r(()=>{if(0===a.length)return;const t=a[0];return n(t=>[...t,e()]),i(e=>e.slice(1)),t},[a,e]),h=r(()=>{n([]),i([])},[]);return{addState:c,undo:d,redo:s,canUndo:t.length>0,canRedo:a.length>0,clearHistory:h}},c=({onUndo:n,onRedo:o,onClear:a,onSave:r,onUpload:i,onDrawingModeChange:l,onPenColorChange:c,onPenWidthChange:d,canUndo:s,canRedo:h,isEmpty:u,currentOptions:g,saveText:p="Save",uploadText:m="Upload",clearText:v="Clear",onDownload:C,onResetPen:x,showGrid:b=!1,onToggleGrid:w,showEraser:f=!1,onEraserMode:W})=>e("div",{className:"signature-controls",role:"toolbar","aria-label":"Signature controls",children:[e("div",{className:"controls-left",children:[t("button",{onClick:n,disabled:!s,className:"control-button",title:"Undo","aria-label":"Undo",children:"↶"}),t("button",{onClick:o,disabled:!h,className:"control-button",title:"Redo","aria-label":"Redo",children:"↷"}),e("select",{value:g.drawingMode,onChange:e=>l(e.target.value),className:"control-select","aria-label":"Drawing mode",children:[t("option",{value:"pen",children:"Pen"}),t("option",{value:"marker",children:"Marker"}),t("option",{value:"highlighter",children:"Highlighter"}),f&&t("option",{value:"eraser",children:"Eraser"})]}),t("input",{type:"color",value:g.penColor,onChange:e=>c(e.target.value),className:"control-color",title:"Pen Color","aria-label":"Pen color"}),t("input",{type:"range",min:"1",max:"10",value:g.penWidth,onChange:e=>d(parseInt(e.target.value)),className:"control-slider",title:"Pen Width","aria-label":"Pen width"}),e("span",{className:"pen-width-label","aria-label":"Pen width value",children:[g.penWidth,"px"]}),x&&t("button",{onClick:x,className:"control-button",title:"Reset Pen Settings","aria-label":"Reset pen settings",children:"Reset"}),f&&W&&t("button",{onClick:W,className:"control-button",title:"Eraser Mode","aria-label":"Eraser mode",children:"Eraser"}),w&&t("button",{onClick:w,className:"control-button",title:b?"Hide Grid":"Show Grid","aria-label":b?"Hide grid":"Show grid",children:b?"Hide Grid":"Show Grid"})]}),e("div",{className:"controls-right",children:[t("button",{onClick:a,className:"control-button clear-button",title:v,"aria-label":"Clear signature",children:v}),r&&t("button",{onClick:r,disabled:u,className:"control-button save-button",title:p,"aria-label":"Save signature",children:p}),i&&t("button",{onClick:i,disabled:u,className:"control-button upload-button",title:m,"aria-label":"Upload signature",children:m}),C&&t("button",{onClick:C,disabled:u,className:"control-button",title:"Download signature","aria-label":"Download signature",children:"Download"})]})]}),d=({options:n,onOptionsChange:o,onClose:a})=>{const r=(e,t)=>{o({[e]:t})};return e("div",{className:"signature-customization-panel",children:[e("div",{className:"panel-header",children:[t("h3",{children:"Customize Signature"}),t("button",{onClick:a,className:"close-button",children:"×"})]}),e("div",{className:"panel-content",children:[e("div",{className:"option-group",children:[t("label",{children:"Pen Color"}),t("input",{type:"color",value:n.penColor||"#000000",onChange:e=>r("penColor",e.target.value)})]}),e("div",{className:"option-group",children:[t("label",{children:"Pen Width"}),t("input",{type:"range",min:"1",max:"10",value:n.penWidth||2,onChange:e=>r("penWidth",parseInt(e.target.value))}),e("span",{children:[n.penWidth||2,"px"]})]}),e("div",{className:"option-group",children:[t("label",{children:"Background Color"}),t("input",{type:"color",value:n.backgroundColor||"#ffffff",onChange:e=>r("backgroundColor",e.target.value)})]}),e("div",{className:"option-group",children:[t("label",{children:"Drawing Mode"}),e("select",{value:n.drawingMode||"pen",onChange:e=>r("drawingMode",e.target.value),children:[t("option",{value:"pen",children:"Pen"}),t("option",{value:"marker",children:"Marker"}),t("option",{value:"highlighter",children:"Highlighter"})]})]}),e("div",{className:"option-group",children:[t("label",{children:"Min Width"}),t("input",{type:"range",min:"0.5",max:"5",step:"0.5",value:n.minWidth||.5,onChange:e=>r("minWidth",parseFloat(e.target.value))}),e("span",{children:[n.minWidth||.5,"px"]})]}),e("div",{className:"option-group",children:[t("label",{children:"Max Width"}),t("input",{type:"range",min:"1",max:"10",step:"0.5",value:n.maxWidth||2.5,onChange:e=>r("maxWidth",parseFloat(e.target.value))}),e("span",{children:[n.maxWidth||2.5,"px"]})]}),e("div",{className:"option-group",children:[t("label",{children:"Velocity Sensitivity"}),t("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:n.velocityFilterWeight||.7,onChange:e=>r("velocityFilterWeight",parseFloat(e.target.value))}),t("span",{children:n.velocityFilterWeight||.7})]})]})]})},s=({onSave:s,onUpload:h,onClear:u,onChange:g,options:p={},className:m="",showControls:v=!0,showCustomization:C=!0,uploadButton:x=!1,uploadText:b="Upload Signature",saveButton:w=!0,saveText:f="Save Signature",clearButton:W=!0,clearText:y="Clear",maxWidth:M=800,maxHeight:k=300})=>{const N=n(null),S=n(null),[R,P]=o(!1),[E,U]=o(!1),[T,D]=o(p),{isEmpty:F,draw:A,clear:X,undo:Y,redo:B,canUndo:H,canRedo:I,exportAsImage:G,exportAsSVG:O,toDataURL:z,setDrawingMode:L,setPenColor:V,setPenWidth:q,setBackgroundColor:$,setMinWidth:j,setMaxWidth:J,setVelocityFilterWeight:K,currentOptions:Q}=i(N,T),{addState:Z,undo:_,redo:ee,canUndo:te,canRedo:ne}=l(()=>z("image/png")),oe=r(()=>{_()},[_]),ae=r(()=>{ee()},[ee]);a(()=>{R||F||Z(z("image/png"))},[R,F,Z]),a(()=>{null==g||g(F)},[F,g]);const re=r(()=>{const e=z("image/png");null==s||s(e)},[z,s]),ie=r(()=>{const e=z("image/png");if(h)h(e);else{const t=document.createElement("a");t.download="signature.png",t.href=e,t.click()}},[z,h]),le=r(()=>{X(),null==u||u(),Z(z("image/png"))},[X,u,Z]),ce=r(e=>{D(t=>({...t,...e})),e.penColor&&V(e.penColor),e.penWidth&&q(e.penWidth),e.backgroundColor&&$(e.backgroundColor),e.drawingMode&&L(e.drawingMode),e.minWidth&&j(e.minWidth),e.maxWidth&&J(e.maxWidth),e.velocityFilterWeight&&K(e.velocityFilterWeight)},[V,q,$,L,j,J,K]);return a(()=>{const e=()=>{if(N.current&&S.current){const e=S.current.clientWidth,t=Math.min(e,M),n=k;if(N.current.width=t,N.current.height=n,F){const e=N.current.getContext("2d");e&&T.backgroundColor&&(e.fillStyle=T.backgroundColor,e.fillRect(0,0,t,n))}else{const e=z("image/png"),o=N.current.getContext("2d");if(o&&e){const a=new Image;a.onload=()=>{o.drawImage(a,0,0,t,n)},a.src=e}}}};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[F,z,M,k,T.backgroundColor]),e("div",{className:`react-signature-pad ${m}`,ref:S,style:{maxWidth:`${M}px`,maxHeight:`${k+100}px`},children:[C&&t("button",{className:"customize-toggle",onClick:()=>U(!E),children:E?"Hide Options":"Customize"}),E&&t(d,{options:T,onOptionsChange:ce,onClose:()=>U(!1)}),v&&t(c,{onUndo:oe,onRedo:ae,onClear:le,onSave:w?re:void 0,onUpload:x?ie:void 0,onDrawingModeChange:L,onPenColorChange:V,onPenWidthChange:q,canUndo:te,canRedo:ne,isEmpty:F,currentOptions:Q,saveText:f,uploadText:b,clearText:y}),e("div",{className:"signature-canvas-container",children:[t("canvas",{ref:N,className:"signature-canvas",onMouseDown:e=>{P(!0),A.start(e.nativeEvent)},onMouseMove:e=>{R&&A.move(e.nativeEvent)},onMouseUp:()=>{P(!1),A.end()},onMouseLeave:()=>{R&&(P(!1),A.end())},onTouchStart:e=>{P(!0),A.start(e.nativeEvent),e.preventDefault()},onTouchMove:e=>{R&&(A.move(e.nativeEvent),e.preventDefault())},onTouchEnd:()=>{P(!1),A.end()},onTouchCancel:()=>{P(!1),A.end()}}),F&&t("div",{className:"signature-placeholder",children:"Sign here"})]})]})},h=e=>{const t=e.split(";base64,"),n=t[0].split(":")[1],o=window.atob(t[1]),a=new Uint8Array(o.length);for(let e=0;e<o.length;++e)a[e]=o.charCodeAt(e);return new Blob([a],{type:n})},u=(e,t)=>{const n=document.createElement("a");n.download=t,n.href=e,n.click()},g=(e,t)=>{const n=h(e);return new File([n],t,{type:n.type})},p=async(e,t,n="signature")=>{const o=new FormData,a=g(e,"signature.png");return o.append(n,a),fetch(t,{method:"POST",body:o})},m=e=>{if(e.length<5)return!1;const t=v(e);if((t.maxX-t.minX)*(t.maxY-t.minY)<100)return!1;return!(C(e)<50)},v=e=>{if(0===e.length)return{minX:0,minY:0,maxX:0,maxY:0};let t=e[0].x,n=e[0].y,o=e[0].x,a=e[0].y;for(let r=1;r<e.length;r++)t=Math.min(t,e[r].x),n=Math.min(n,e[r].y),o=Math.max(o,e[r].x),a=Math.max(a,e[r].y);return{minX:t,minY:n,maxX:o,maxY:a}},C=e=>{let t=0;for(let n=1;n<e.length;n++)t+=Math.sqrt(Math.pow(e[n].x-e[n-1].x,2)+Math.pow(e[n].y-e[n-1].y,2));return t},x=e=>{if(!document.createElement("canvas").getContext("2d"))return!0;return(new Image).src=e,""===e||e.includes("data:image/png;base64,AAAA")};export{s as SignaturePad,C as calculateTotalDistance,h as dataURLToBlob,g as dataURLToFile,s as default,u as downloadDataURL,v as getBoundingBox,x as isSignatureEmpty,p as uploadDataURL,i as useSignature,l as useUndoRedo,m as validateSignature};
//# sourceMappingURL=index.js.map
