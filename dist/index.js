"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),t=require("react");const n=(e,n)=>{const a=t.useRef([]),[o,l]=t.useState(!0),[r,i]=t.useState({width:n.width||800,height:n.height||300,penColor:n.penColor||"#000000",penWidth:n.penWidth||2,backgroundColor:n.backgroundColor||"#ffffff",drawingMode:n.drawingMode||"pen",minWidth:n.minWidth||.5,maxWidth:n.maxWidth||2.5,velocityFilterWeight:n.velocityFilterWeight||.7});t.useEffect(()=>{i(e=>({...e,...n,width:n.width||e.width,height:n.height||e.height}))},[n]),t.useEffect(()=>{const t=e.current;if(!t)return;const n=t.getContext("2d");n&&(n.lineCap="round",n.lineJoin="round",n.fillStyle=r.backgroundColor,n.fillRect(0,0,t.width,t.height),l(!0))},[e,r.backgroundColor]);const s={start:t.useCallback(t=>{const n=e.current;if(!n)return;const o=n.getContext("2d");if(!o)return;const r=n.getBoundingClientRect(),i="touches"in t?t.touches[0].clientX:t.clientX,s="touches"in t?t.touches[0].clientY:t.clientY,c={x:i-r.left,y:s-r.top,time:Date.now(),pressure:"pressure"in t?t.pressure:.5};a.current=[c],l(!1),o.beginPath(),o.moveTo(c.x,c.y)},[e]),move:t.useCallback(t=>{if(0===a.current.length)return;const n=e.current;if(!n)return;const o=n.getContext("2d");if(!o)return;const l=n.getBoundingClientRect(),i="touches"in t?t.touches[0].clientX:t.clientX,s="touches"in t?t.touches[0].clientY:t.clientY,c={x:i-l.left,y:s-l.top,time:Date.now(),pressure:"pressure"in t?t.pressure:.5},d=a.current;d.push(c);const u=(e=>{if(e.length<2)return 0;const t=e[e.length-1],n=e[e.length-2],a=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),o=t.time-n.time;return o>0?a/o:0})(d),h=r.penWidth;let g=h;"marker"===r.drawingMode?g=Math.max(r.minWidth,h-u*h/3):"highlighter"===r.drawingMode?(g=h+2,o.globalAlpha=.5):g=Math.max(r.minWidth,Math.min(r.maxWidth,h-u*h/5)),o.lineWidth=g,o.strokeStyle=r.penColor,((e,t)=>{if(t.length<3){const n=t[0];return e.lineTo(n.x,n.y),void e.stroke()}e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let n=1;n<t.length-2;n++){const a=(t[n].x+t[n+1].x)/2,o=(t[n].y+t[n+1].y)/2;e.quadraticCurveTo(t[n].x,t[n].y,a,o)}e.quadraticCurveTo(t[t.length-2].x,t[t.length-2].y,t[t.length-1].x,t[t.length-1].y),e.stroke()})(o,d),"highlighter"===r.drawingMode&&(o.globalAlpha=1),d.length>5&&(a.current=d.slice(-5))},[e,r]),end:t.useCallback(()=>{a.current=[]},[])},c=t.useCallback(()=>{const t=e.current;if(!t)return;const n=t.getContext("2d");n&&(n.clearRect(0,0,t.width,t.height),n.fillStyle=r.backgroundColor,n.fillRect(0,0,t.width,t.height),l(!0),a.current=[])},[e,r.backgroundColor]),d=t.useCallback((t,n)=>{const a=e.current;return!a||o?"":a.toDataURL(t,n)},[e,o]),u=t.useCallback((e="signature")=>{const t=d("image/png");if(!t)return;const n=document.createElement("a");n.download=`${e}.png`,n.href=t,n.click()},[d]),h=t.useCallback(()=>"",[]),g=t.useCallback(e=>{i(t=>({...t,drawingMode:e}))},[]),p=t.useCallback(e=>{i(t=>({...t,penColor:e}))},[]),x=t.useCallback(e=>{i(t=>({...t,penWidth:e}))},[]),m=t.useCallback(t=>{i(e=>({...e,backgroundColor:t}));const n=e.current;if(n){const e=n.getContext("2d");if(e&&(e.fillStyle=t,e.fillRect(0,0,n.width,n.height),!o)){const t=d("image/png");if(t){const n=new Image;n.onload=()=>{e.drawImage(n,0,0)},n.src=t}}}},[e,o,d]),C=t.useCallback(e=>{i(t=>({...t,minWidth:e}))},[]),b=t.useCallback(e=>{i(t=>({...t,maxWidth:e}))},[]),v=t.useCallback(e=>{i(t=>({...t,velocityFilterWeight:e}))},[]);return{isEmpty:o,draw:s,clear:c,undo:()=>{},redo:()=>{},canUndo:!1,canRedo:!1,exportAsImage:u,exportAsSVG:h,toDataURL:d,setDrawingMode:g,setPenColor:p,setPenWidth:x,setBackgroundColor:m,setMinWidth:C,setMaxWidth:b,setVelocityFilterWeight:v,currentOptions:r}},a=e=>{const[n,a]=t.useState([]),[o,l]=t.useState([]),[r]=t.useState(50),i=t.useCallback(e=>{a(t=>[...t,e].slice(-r)),l([])},[r]),s=t.useCallback(()=>{if(0===n.length)return;const t=n[n.length-1],o=e();return a(e=>e.slice(0,-1)),l(e=>[o,...e]),t},[n,e]),c=t.useCallback(()=>{if(0===o.length)return;const t=o[0];return a(t=>[...t,e()]),l(e=>e.slice(1)),t},[o,e]),d=t.useCallback(()=>{a([]),l([])},[]);return{addState:i,undo:s,redo:c,canUndo:n.length>0,canRedo:o.length>0,clearHistory:d}},o=({onUndo:t,onRedo:n,onClear:a,onSave:o,onUpload:l,onDrawingModeChange:r,onPenColorChange:i,onPenWidthChange:s,canUndo:c,canRedo:d,isEmpty:u,currentOptions:h,saveText:g="Save",uploadText:p="Upload",clearText:x="Clear",onDownload:m,onResetPen:C,showGrid:b=!1,onToggleGrid:v,showEraser:f=!1,onEraserMode:w})=>e.jsxs("div",{className:"signature-controls",role:"toolbar","aria-label":"Signature controls",children:[e.jsxs("div",{className:"controls-left",children:[e.jsx("button",{onClick:t,disabled:!c,className:"control-button",title:"Undo","aria-label":"Undo",children:"↶"}),e.jsx("button",{onClick:n,disabled:!d,className:"control-button",title:"Redo","aria-label":"Redo",children:"↷"}),e.jsxs("select",{value:h.drawingMode,onChange:e=>r(e.target.value),className:"control-select","aria-label":"Drawing mode",children:[e.jsx("option",{value:"pen",children:"Pen"}),e.jsx("option",{value:"marker",children:"Marker"}),e.jsx("option",{value:"highlighter",children:"Highlighter"}),f&&e.jsx("option",{value:"eraser",children:"Eraser"})]}),e.jsx("input",{type:"color",value:h.penColor,onChange:e=>i(e.target.value),className:"control-color",title:"Pen Color","aria-label":"Pen color"}),e.jsx("input",{type:"range",min:"1",max:"10",value:h.penWidth,onChange:e=>s(parseInt(e.target.value)),className:"control-slider",title:"Pen Width","aria-label":"Pen width"}),e.jsxs("span",{className:"pen-width-label","aria-label":"Pen width value",children:[h.penWidth,"px"]}),C&&e.jsx("button",{onClick:C,className:"control-button",title:"Reset Pen Settings","aria-label":"Reset pen settings",children:"Reset"}),f&&w&&e.jsx("button",{onClick:w,className:"control-button",title:"Eraser Mode","aria-label":"Eraser mode",children:"Eraser"}),v&&e.jsx("button",{onClick:v,className:"control-button",title:b?"Hide Grid":"Show Grid","aria-label":b?"Hide grid":"Show grid",children:b?"Hide Grid":"Show Grid"})]}),e.jsxs("div",{className:"controls-right",children:[e.jsx("button",{onClick:a,className:"control-button clear-button",title:x,"aria-label":"Clear signature",children:x}),o&&e.jsx("button",{onClick:o,disabled:u,className:"control-button save-button",title:g,"aria-label":"Save signature",children:g}),l&&e.jsx("button",{onClick:l,disabled:u,className:"control-button upload-button",title:p,"aria-label":"Upload signature",children:p}),m&&e.jsx("button",{onClick:m,disabled:u,className:"control-button",title:"Download signature","aria-label":"Download signature",children:"Download"})]})]}),l=({options:t,onOptionsChange:n,onClose:a})=>{const o=(e,t)=>{n({[e]:t})};return e.jsxs("div",{className:"signature-customization-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h3",{children:"Customize Signature"}),e.jsx("button",{onClick:a,className:"close-button",children:"×"})]}),e.jsxs("div",{className:"panel-content",children:[e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Pen Color"}),e.jsx("input",{type:"color",value:t.penColor||"#000000",onChange:e=>o("penColor",e.target.value)})]}),e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Pen Width"}),e.jsx("input",{type:"range",min:"1",max:"10",value:t.penWidth||2,onChange:e=>o("penWidth",parseInt(e.target.value))}),e.jsxs("span",{children:[t.penWidth||2,"px"]})]}),e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Background Color"}),e.jsx("input",{type:"color",value:t.backgroundColor||"#ffffff",onChange:e=>o("backgroundColor",e.target.value)})]}),e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Drawing Mode"}),e.jsxs("select",{value:t.drawingMode||"pen",onChange:e=>o("drawingMode",e.target.value),children:[e.jsx("option",{value:"pen",children:"Pen"}),e.jsx("option",{value:"marker",children:"Marker"}),e.jsx("option",{value:"highlighter",children:"Highlighter"})]})]}),e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Min Width"}),e.jsx("input",{type:"range",min:"0.5",max:"5",step:"0.5",value:t.minWidth||.5,onChange:e=>o("minWidth",parseFloat(e.target.value))}),e.jsxs("span",{children:[t.minWidth||.5,"px"]})]}),e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Max Width"}),e.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:t.maxWidth||2.5,onChange:e=>o("maxWidth",parseFloat(e.target.value))}),e.jsxs("span",{children:[t.maxWidth||2.5,"px"]})]}),e.jsxs("div",{className:"option-group",children:[e.jsx("label",{children:"Velocity Sensitivity"}),e.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:t.velocityFilterWeight||.7,onChange:e=>o("velocityFilterWeight",parseFloat(e.target.value))}),e.jsx("span",{children:t.velocityFilterWeight||.7})]})]})]})},r=({onSave:r,onUpload:i,onClear:s,onChange:c,options:d={},className:u="",showControls:h=!0,showCustomization:g=!0,uploadButton:p=!1,uploadText:x="Upload Signature",saveButton:m=!0,saveText:C="Save Signature",clearButton:b=!0,clearText:v="Clear",maxWidth:f=800,maxHeight:w=300})=>{const k=t.useRef(null),j=t.useRef(null),[y,W]=t.useState(!1),[M,S]=t.useState(!1),[N,R]=t.useState(d),{isEmpty:E,draw:U,clear:P,undo:T,redo:D,canUndo:F,canRedo:A,exportAsImage:B,exportAsSVG:L,toDataURL:X,setDrawingMode:Y,setPenColor:H,setPenWidth:I,setBackgroundColor:O,setMinWidth:G,setMaxWidth:z,setVelocityFilterWeight:q,currentOptions:V}=n(k,N),{addState:$,undo:_,redo:J,canUndo:K,canRedo:Q}=a(()=>X("image/png")),Z=t.useCallback(()=>{_()},[_]),ee=t.useCallback(()=>{J()},[J]);t.useEffect(()=>{y||E||$(X("image/png"))},[y,E,$]),t.useEffect(()=>{null==c||c(E)},[E,c]);const te=t.useCallback(()=>{const e=X("image/png");null==r||r(e)},[X,r]),ne=t.useCallback(()=>{const e=X("image/png");if(i)i(e);else{const t=document.createElement("a");t.download="signature.png",t.href=e,t.click()}},[X,i]),ae=t.useCallback(()=>{P(),null==s||s(),$(X("image/png"))},[P,s,$]),oe=t.useCallback(e=>{R(t=>({...t,...e})),e.penColor&&H(e.penColor),e.penWidth&&I(e.penWidth),e.backgroundColor&&O(e.backgroundColor),e.drawingMode&&Y(e.drawingMode),e.minWidth&&G(e.minWidth),e.maxWidth&&z(e.maxWidth),e.velocityFilterWeight&&q(e.velocityFilterWeight)},[H,I,O,Y,G,z,q]);return t.useEffect(()=>{const e=()=>{if(k.current&&j.current){const e=j.current.clientWidth,t=Math.min(e,f),n=w;if(k.current.width=t,k.current.height=n,E){const e=k.current.getContext("2d");e&&N.backgroundColor&&(e.fillStyle=N.backgroundColor,e.fillRect(0,0,t,n))}else{const e=X("image/png"),a=k.current.getContext("2d");if(a&&e){const o=new Image;o.onload=()=>{a.drawImage(o,0,0,t,n)},o.src=e}}}};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[E,X,f,w,N.backgroundColor]),e.jsxs("div",{className:`react-signature-pad ${u}`,ref:j,style:{maxWidth:`${f}px`,maxHeight:`${w+100}px`},children:[g&&e.jsx("button",{className:"customize-toggle",onClick:()=>S(!M),children:M?"Hide Options":"Customize"}),M&&e.jsx(l,{options:N,onOptionsChange:oe,onClose:()=>S(!1)}),h&&e.jsx(o,{onUndo:Z,onRedo:ee,onClear:ae,onSave:m?te:void 0,onUpload:p?ne:void 0,onDrawingModeChange:Y,onPenColorChange:H,onPenWidthChange:I,canUndo:K,canRedo:Q,isEmpty:E,currentOptions:V,saveText:C,uploadText:x,clearText:v}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:k,className:"signature-canvas",onMouseDown:e=>{W(!0),U.start(e.nativeEvent)},onMouseMove:e=>{y&&U.move(e.nativeEvent)},onMouseUp:()=>{W(!1),U.end()},onMouseLeave:()=>{y&&(W(!1),U.end())},onTouchStart:e=>{W(!0),U.start(e.nativeEvent),e.preventDefault()},onTouchMove:e=>{y&&(U.move(e.nativeEvent),e.preventDefault())},onTouchEnd:()=>{W(!1),U.end()},onTouchCancel:()=>{W(!1),U.end()}}),E&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]})]})},i=e=>{const t=e.split(";base64,"),n=t[0].split(":")[1],a=window.atob(t[1]),o=new Uint8Array(a.length);for(let e=0;e<a.length;++e)o[e]=a.charCodeAt(e);return new Blob([o],{type:n})},s=(e,t)=>{const n=i(e);return new File([n],t,{type:n.type})},c=e=>{if(0===e.length)return{minX:0,minY:0,maxX:0,maxY:0};let t=e[0].x,n=e[0].y,a=e[0].x,o=e[0].y;for(let l=1;l<e.length;l++)t=Math.min(t,e[l].x),n=Math.min(n,e[l].y),a=Math.max(a,e[l].x),o=Math.max(o,e[l].y);return{minX:t,minY:n,maxX:a,maxY:o}},d=e=>{let t=0;for(let n=1;n<e.length;n++)t+=Math.sqrt(Math.pow(e[n].x-e[n-1].x,2)+Math.pow(e[n].y-e[n-1].y,2));return t};exports.SignaturePad=r,exports.calculateTotalDistance=d,exports.dataURLToBlob=i,exports.dataURLToFile=s,exports.default=r,exports.downloadDataURL=(e,t)=>{const n=document.createElement("a");n.download=t,n.href=e,n.click()},exports.getBoundingBox=c,exports.isSignatureEmpty=e=>{if(!document.createElement("canvas").getContext("2d"))return!0;return(new Image).src=e,""===e||e.includes("data:image/png;base64,AAAA")},exports.uploadDataURL=async(e,t,n="signature")=>{const a=new FormData,o=s(e,"signature.png");return a.append(n,o),fetch(t,{method:"POST",body:a})},exports.useSignature=n,exports.useUndoRedo=a,exports.validateSignature=e=>{if(e.length<5)return!1;const t=c(e);if((t.maxX-t.minX)*(t.maxY-t.minY)<100)return!1;return!(d(e)<50)};
//# sourceMappingURL=index.js.map
